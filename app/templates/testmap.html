<!DOCTYPE html>
<html>
   <head>
     <meta name="google-site-verification" content="fttcwGg9F1gbh8l5e_24FFe9nGrpDViWjDw3Vljeoec" />
      <title>Test Google Maps</title>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
       <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/style.css') }}" />
       <!-- <script src="{{ url_for('static', filename='index.js') }}"></script> -->
   </head>
   <body>
      <h1>Map</h1>

      <form action = "index" method = "get">
      <table>
      <tr>
      <td align colspan= "right"> <label for="Longitude"> Longitude: </label> </td>
      <td> <input type="text" name = "long" ></td>
      </tr>
      <tr>
      <td align = "right"><label for="Latitude"> Latitude:</label></td>
      <td><Input type="text", name = "lat" ></td>
      </tr>
      <tr>
      <td align = "right"><label for="Text"> Text:</label></td>
      <td><Input type = "text", name = "text"></td>
      </tr>
      <tr>
      <td></td>
      <td><input type="submit", id = "submit" value = "Create"></td>
      </tr>
      </table>
      </form>


      <div id = "map"></div>

      <script>
      "use strict"

      let map;
      let events;

      function initMap() {

        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat:40.34657, lng: -74.65631 },
          zoom: 16,
        });
        let regex = /\d+/
        var counts = {{ eventData|tojson }}
        counts.forEach(function(element){
          console.log(element[3]);
          let str = String(element[3]);
          str = element[3].slice(1, element[3].length() - 1);
          let coords = str.split(',');
          // let nums = element[3].match(regex);
          console.log(coords);
          const marker = new google.maps.Marker({
           position: { lat: parseFloat(coords[1]), lng:parseFloat(coords[0]) },
           map: map,
         });
        })
        }
      // function initMap(events) {
      //   map = new google.maps.Map(document.getElementById("map"), {
      //     center: { lat: 40.34657, lng: -74.65631 },
      //     zoom: 16,
      //   });
      //   for (let event in events) {
      //     const marker = new google.maps.Marker({
      //     position: { lat: parseFloat(nums[1]), lng: parseFloat(nums[0]) },
      //     map: map,
      //     });
      //   }
      // }
        // const infoWindow = new google.maps.InfoWindow();




      //   const marker = new google.maps.Marker({
      //    position: { lat: 40.34657, lng: -74.65631 },
      //    map: map,
      //  });
      //  marker.addListener("click", () => {
      //       infoWindow.close();
      //       infoWindow.setContent(marker.getTitle());
      //       infoWindow.open(marker.getMap(), marker);
      //     });
      // }


  document.getElementById("submit").onclick =  initMap;

  </script>

  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3KgDnvZgxSc4QSXw2ag40SLeG5wAXVoI&callback=initMap">

  </script>




      <!-- <script>
      'use strict';
      // function addPoint{
      //
      // }
      function setup(){
      $('#submit').on('input', addPoint;)
    }
      </script> -->
      {% if eventData != None %}
      <table>
        <tr>
          <th align="left">Event ID</th>
          <th align="left">Title</th>
          <th align="left">Location</th>
          <th align="left">Coordinates</th>
        </tr>
        {% for event in eventData %}
        <tr>
          <td>{{event[0]}}</td>
          <td>{{event[1]}}</td>
          <td>{{event[2]}}</td>
          <td>{{event[3]}}</td>
        </tr>
        {% endfor %}
      </table>
      {% endif %}
      <hr>
      Created by Benjamin Nadon</a>.
      <hr>

   </body>
</html>
